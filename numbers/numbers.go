package numbers

import (
	"math"
	"math/rand"
	"time"
)

// constants & variables ******************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// public functions ***********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// MaxInt
// ****************************************************************************************************************************************
func MaxInt(num int, nums ...int) int {
	for _, v := range nums {
		if num < v {
			num = v
		}
	}

	return num
}

// MinInt
// ****************************************************************************************************************************************
func MinInt(num int, nums ...int) int {
	for _, v := range nums {
		if num > v {
			num = v
		}
	}

	return num
}

// Rand
// ****************************************************************************************************************************************
func Rand(min, max int) Random {
	return &random{
		rand.New(rand.NewSource(time.Now().UnixNano())),
		max,
		min,
	}
}

// GetPathParent
// ****************************************************************************************************************************************
func GetPathParent(id, gap uint64) (parent uint64, step uint64) {
	return getPathParent(id, gap, 0)
}

// type defineds **************************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// Random
// ****************************************************************************************************************************************
type Random interface {
	NextInt() int
}

// random *********************************************************************************************************************************
type random struct {
	*rand.Rand
	max int
	min int
}

// Next
// ****************************************************************************************************************************************
func (o *random) NextInt() int {
	return o.Rand.Intn(o.max-o.min) + o.min
}

// private functions **********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// getPathParent **************************************************************************************************************************
func getPathParent(id, gap, step uint64) (uint64, uint64) {
	step = uint64(MaxInt(int(step), 0))
	path := uint64(math.Pow(float64(gap), float64(step)))
	if r := id % path; r > 0 {
		return id - r, (path / gap)
	}

	return getPathParent(id, gap, step+1)
}
