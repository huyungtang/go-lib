package barcode

import (
	"bytes"
	"image/png"

	"github.com/boombuler/barcode"
	"github.com/boombuler/barcode/code128"
	"github.com/boombuler/barcode/qr"
)

// constants & variables ******************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// public functions ***********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// Code128
// ****************************************************************************************************************************************
func Code128(str string, width, height int) (reader *bytes.Reader, err error) {
	var bar barcode.Barcode
	if bar, err = code128.Encode(str); err != nil {
		return
	}

	return barcodeCreateReader(bar, width, height)
}

// QRCode
// ****************************************************************************************************************************************
func QRCode(str string, width int) (reader *bytes.Reader, err error) {
	var bar barcode.Barcode
	if bar, err = qr.Encode(str, qr.M, qr.Auto); err != nil {
		return
	}

	return barcodeCreateReader(bar, width, width)
}

// type defineds **************************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// private functions **********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// barcodeCreateReader barcode transfer bytes reader **************************************************************************************
func barcodeCreateReader(bar barcode.Barcode, wid, hei int) (reader *bytes.Reader, err error) {
	bar, _ = barcode.Scale(bar, wid, hei)
	buf := new(bytes.Buffer)
	if err = png.Encode(buf, bar); err != nil {
		return
	}

	return bytes.NewReader(buf.Bytes()), nil
}
