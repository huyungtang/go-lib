package cache

// constants & variables ******************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

var (
	ExpiredOption Options = ExpireOption(Expired)
	KeepTTLOption Options = ExpireOption(KeepTTL)
	StaticOption  Options = ExpireOption(Static)

	SkipOverrideOption Options = overrideOption("NX")
	UpdateOnlyOption   Options = overrideOption("XX")
)

// public functions ***********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// DefaultOption
// ****************************************************************************************************************************************
func DefaultOption(fn DefaultFn) Options {
	return func(co *Option) {
		co.DefaFn = fn
	}
}

// ExpireOption
// ****************************************************************************************************************************************
func ExpireOption(sec int64) Options {
	return func(co *Option) {
		co.Expire = sec
	}
}

// type defineds **************************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// Option
// ****************************************************************************************************************************************
type Option struct {
	DefaFn   DefaultFn
	Expire   int64
	Override string
}

// ApplyOptions
// ****************************************************************************************************************************************
func (o *Option) ApplyOptions(opts []Options, defa ...Options) (opt *Option) {
	opts = append(defa, opts...)
	for _, optFn := range opts {
		optFn(o)
	}

	return o
}

// Options
// ****************************************************************************************************************************************
type Options func(*Option)

// DefaultFn
// ****************************************************************************************************************************************
type DefaultFn func(interface{}) (Options, error)

// private functions **********************************************************************************************************************
// ****************************************************************************************************************************************
// ****************************************************************************************************************************************

// overrideOption *************************************************************************************************************************
func overrideOption(over string) Options {
	return func(co *Option) {
		co.Override = over
	}
}
